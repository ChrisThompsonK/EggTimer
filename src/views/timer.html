<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egg Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: #5a67d8;
            margin-bottom: 2rem;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .timer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .timer-option {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            border: none;
            border-radius: 15px;
            padding: 1rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .timer-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(238, 90, 111, 0.3);
        }

        .timer-option:active {
            transform: translateY(0);
        }

        .timer-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .timer-option:hover::before {
            left: 100%;
        }

        .custom-timer {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(90, 103, 216, 0.1);
            border-radius: 15px;
            border: 2px dashed #5a67d8;
        }

        .custom-timer h3 {
            color: #5a67d8;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .time-inputs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .time-input {
            width: 60px;
            padding: 0.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .time-input:focus {
            outline: none;
            border-color: #5a67d8;
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }

        .time-label {
            font-size: 0.8rem;
            color: #666;
        }

        .start-custom {
            background: linear-gradient(45deg, #5a67d8, #667eea);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-custom:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }

        .timer-display {
            display: none;
            margin-top: 2rem;
        }

        .timer-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .timer-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .timer-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid transparent;
            border-top-color: #ff6b6b;
            transform: rotate(-90deg);
            transition: transform 1s linear;
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 600;
            color: #333;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .control-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pause-btn {
            background: linear-gradient(45deg, #ffa726, #fb8c00);
            color: white;
        }

        .stop-btn {
            background: linear-gradient(45deg, #ef5350, #e53935);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .notification {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
        }

        .notification.success {
            background: linear-gradient(45deg, #66bb6a, #43a047);
            color: white;
        }

        .navigation {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #e2e8f0;
        }

        .nav-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            color: #5a67d8;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-link:hover {
            background: rgba(90, 103, 216, 0.1);
            transform: translateY(-1px);
        }

        @media (max-width: 480px) {
            .container {
                padding: 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .timer-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .timer-option {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .time-inputs {
                gap: 0.25rem;
            }

            .time-input {
                width: 50px;
            }

            .timer-circle {
                width: 150px;
                height: 150px;
            }

            .timer-text {
                font-size: 1.5rem;
            }

            .timer-controls {
                gap: 0.5rem;
            }

            .control-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ¥š Egg Timer</h1>
        
        <div class="timer-options">
            <button class="timer-option" onclick="startTimer(180)">
                Soft Boiled<br><small>3 minutes</small>
            </button>
            <button class="timer-option" onclick="startTimer(360)">
                Medium Boiled<br><small>6 minutes</small>
            </button>
            <button class="timer-option" onclick="startTimer(480)">
                Hard Boiled<br><small>8 minutes</small>
            </button>
            <button class="timer-option" onclick="startTimer(600)">
                Well Done<br><small>10 minutes</small>
            </button>
        </div>

        <div class="custom-timer">
            <h3>ðŸŽ¯ Custom Timer</h3>
            <div class="time-inputs">
                <div>
                    <input type="number" class="time-input" id="hours" min="0" max="23" value="0">
                    <div class="time-label">hours</div>
                </div>
                <div>
                    <input type="number" class="time-input" id="minutes" min="0" max="59" value="0">
                    <div class="time-label">minutes</div>
                </div>
                <div>
                    <input type="number" class="time-input" id="seconds" min="0" max="59" value="30">
                    <div class="time-label">seconds</div>
                </div>
            </div>
            <button class="start-custom" onclick="startCustomTimer()">Start Custom Timer</button>
        </div>

        <div class="timer-display" id="timerDisplay">
            <div class="timer-circle">
                <div class="timer-ring">
                    <div class="timer-progress" id="timerProgress"></div>
                </div>
                <div class="timer-text" id="timerText">00:00</div>
            </div>
            
            <div class="timer-controls">
                <button class="control-btn pause-btn" onclick="pauseTimer()">Pause</button>
                <button class="control-btn stop-btn" onclick="stopTimer()">Stop</button>
            </div>
        </div>

        <div class="notification" id="notification"></div>

        <div class="navigation">
            <a href="/about" class="nav-link">ðŸ“– About</a>
        </div>
    </div>

    <script>
        let currentTimerId = null;
        let isPaused = false;
        let totalDuration = 0;
        let remainingTime = 0;

        async function startTimer(duration) {
            try {
                showTimer();
                totalDuration = duration;
                remainingTime = duration;
                
                const response = await fetch('/api/timers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ duration })
                });

                if (!response.ok) {
                    throw new Error('Failed to start timer');
                }

                const timer = await response.json();
                currentTimerId = timer.id;
                
                updateTimerDisplay();
                showNotification('Timer started!', 'success');
                
            } catch (error) {
                console.error('Error starting timer:', error);
                showNotification('Failed to start timer', 'error');
            }
        }

        function startCustomTimer() {
            const hours = parseInt(document.getElementById('hours').value) || 0;
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            
            const duration = hours * 3600 + minutes * 60 + seconds;
            
            if (duration <= 0) {
                showNotification('Please set a valid time', 'error');
                return;
            }
            
            startTimer(duration);
        }

        async function pauseTimer() {
            if (!currentTimerId) return;
            
            try {
                const action = isPaused ? 'resume' : 'pause';
                const response = await fetch(`/api/timers/${currentTimerId}/${action}`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error(`Failed to ${action} timer`);
                }

                isPaused = !isPaused;
                const pauseBtn = document.querySelector('.pause-btn');
                pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
                
                showNotification(isPaused ? 'Timer paused' : 'Timer resumed', 'success');
                
            } catch (error) {
                console.error('Error pausing/resuming timer:', error);
                showNotification('Failed to pause/resume timer', 'error');
            }
        }

        async function stopTimer() {
            if (!currentTimerId) return;
            
            try {
                const response = await fetch(`/api/timers/${currentTimerId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to stop timer');
                }

                resetTimer();
                showNotification('Timer stopped', 'success');
                
            } catch (error) {
                console.error('Error stopping timer:', error);
                showNotification('Failed to stop timer', 'error');
            }
        }

        function showTimer() {
            document.getElementById('timerDisplay').style.display = 'block';
            const pauseBtn = document.querySelector('.pause-btn');
            pauseBtn.textContent = 'Pause';
            isPaused = false;
        }

        function resetTimer() {
            document.getElementById('timerDisplay').style.display = 'none';
            currentTimerId = null;
            isPaused = false;
            totalDuration = 0;
            remainingTime = 0;
            
            // Reset progress ring
            const progress = document.getElementById('timerProgress');
            progress.style.transform = 'rotate(-90deg)';
        }

        function updateTimerDisplay() {
            if (!currentTimerId || isPaused) return;
            
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            const timeText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerText').textContent = timeText;
            
            // Update progress ring
            const progress = (totalDuration - remainingTime) / totalDuration;
            const degrees = progress * 360 - 90;
            document.getElementById('timerProgress').style.transform = `rotate(${degrees}deg)`;
            
            if (remainingTime <= 0) {
                showNotification('Time\'s up! ðŸ””', 'success');
                resetTimer();
                return;
            }
            
            remainingTime--;
            setTimeout(updateTimerDisplay, 1000);
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Check timer status on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/api/timers');
                if (response.ok) {
                    const timers = await response.json();
                    if (timers.length > 0) {
                        // Resume existing timer if any
                        const activeTimer = timers.find(t => t.status === 'running' || t.status === 'paused');
                        if (activeTimer) {
                            currentTimerId = activeTimer.id;
                            remainingTime = activeTimer.remainingTime;
                            totalDuration = activeTimer.duration;
                            isPaused = activeTimer.status === 'paused';
                            showTimer();
                            if (!isPaused) {
                                updateTimerDisplay();
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking timer status:', error);
            }
        });
    </script>
</body>
</html>
